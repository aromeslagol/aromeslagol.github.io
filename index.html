<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/ico" href="images/favicon.ico">
    <title>é¦–é¡µ | é±¼çª</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lora:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="CSS/common.css">
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="navbar-content">
            <img src="images/thamsan.webp" width="60em">
            <ul class="navbar-menu">
                <li><a href="#" class="nav-link" data-category="all">é¦–é¡µ</a></li>
                <li><a href="#" class="nav-link" data-category="tech">æŠ€æœ¯</a></li>
                <li><a href="#" class="nav-link" data-category="life">ç”Ÿæ´»</a></li>
                <li><a href="#" class="nav-link" data-category="travel">æ—…è¡Œ</a></li>
                <li>
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="æœç´¢æ–‡ç« ..." />
                        <button id="searchBtn" title="æœç´¢">ğŸ”</button>
                        <button id="clearSearchBtn" class="clear-search hidden" title="æ¸…é™¤">âœ•</button>
                        <span class="search-result-count" id="searchCount"></span>
                    </div>
                </li>
                <li><button class="theme-toggle" id="themeToggle">ğŸŒ™</button></li>
            </ul>
        </div>
    </nav>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- å·¦ä¾§å¯¼èˆªæ  -->
        <aside class="sidebar">
            <!-- åˆ†ç±»å¯¼èˆª -->
            <div class="sidebar-section">
                <div class="sidebar-title">åˆ†ç±»</div>
                <ul class="sidebar-list">
                    <li><a class="category-link active" data-category="all">å…¨éƒ¨æ–‡ç« </a></li>
                    <li><a class="category-link" data-category="tech">æŠ€æœ¯æ–‡ç« </a></li>
                    <li><a class="category-link" data-category="life">ç”Ÿæ´»éšç¬”</a></li>
                    <li><a class="category-link" data-category="travel">æ—…è¡Œè®°å½•</a></li>
                </ul>
            </div>

            <!-- æ–‡ç« åˆ—è¡¨ -->
            <div class="sidebar-section">
                <div class="sidebar-title">æœ€æ–°æ–‡ç« </div>
                <ul class="sidebar-list" id="articleList">
                    <!-- åŠ¨æ€åŠ è½½ -->
                </ul>
            </div>
        </aside>

        <!-- æ­£æ–‡å†…å®¹åŒº -->
        <main class="main-content">
            <div id="articleContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>åŠ è½½ä¸­...</p>
                </div>
            </div>
        </main>
    </div>

    <!-- å³ä¸‹è§’åœ†å½¢è¿›åº¦æ¡ -->
    <div class="progress-circle" id="progressCircle">
        <svg viewBox="0 0 100 100">
            <circle class="progress-circle-bg" cx="50" cy="50" r="45"></circle>
            <circle class="progress-circle-fill" cx="50" cy="50" r="45" id="progressFill"></circle>
        </svg>
        <div class="progress-text">
            <div class="progress-percentage" id="progressPercentage">0%</div>
            <div class="progress-label">é˜…è¯»è¿›åº¦</div>
            <div class="reading-time" id="readingTime">0 åˆ†é’Ÿ</div>
        </div>
    </div>

    <!-- jQuery åº“ -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="articles/sample.js"></script>
    <script src="JS/search.js"></script>
    <script src="JS/theme.js"></script>

    <script>
        // ===== æ–‡ç« åŠ è½½å’Œæ˜¾ç¤º =====
        let currentArticle = null;

        function loadArticles(category = 'all') {
            const filteredArticles = category === 'all' 
                ? articles 
                : articles.filter(a => a.category === category);

            const articleList = document.getElementById('articleList');
            articleList.innerHTML = '';

            filteredArticles.forEach(article => {
                const li = document.createElement('li');
                li.innerHTML = `<a class="article-link" data-id="${article.id}">${article.title}</a>`;
                articleList.appendChild(li);
            });

            // åŠ è½½ç¬¬ä¸€ç¯‡æ–‡ç« 
            if (filteredArticles.length > 0) {
                loadArticle(filteredArticles[0].id);
            }
        }

        function loadArticle(articleId) {
            const article = articles.find(a => a.id === articleId);
            if (!article) return;

            currentArticle = article;
            const container = document.getElementById('articleContainer');

            const html = `
                <div class="article-header fade-in">
                    <h1 class="article-title">${article.title}</h1>
                    <div class="article-meta">
                        <span>ğŸ“… ${article.date}</span>
                        <span>âœï¸ ${article.author}</span>
                        <span>â±ï¸ çº¦ ${article.readTime} åˆ†é’Ÿ</span>
                    </div>
                </div>
                <div class="article-content fade-in">
                    ${article.content}
                </div>
            `;

            container.innerHTML = html;

            // æ›´æ–°æ´»è·ƒçŠ¶æ€
            document.querySelectorAll('.article-link').forEach(link => {
                link.classList.remove('active');
                if (parseInt(link.dataset.id) === articleId) {
                    link.classList.add('active');
                }
            });

            // é‡ç½®è¿›åº¦æ¡
            updateProgress();
        }

        // ===== åˆ†ç±»å’Œæ–‡ç« é“¾æ¥äº‹ä»¶ =====
        document.addEventListener('click', function(e) {
            // åˆ†ç±»é“¾æ¥
            if (e.target.classList.contains('category-link')) {
                e.preventDefault();
                document.querySelectorAll('.category-link').forEach(link => {
                    link.classList.remove('active');
                });
                e.target.classList.add('active');
                loadArticles(e.target.dataset.category);
            }

            // é¡¶éƒ¨å¯¼èˆªåˆ†ç±»é“¾æ¥
            if (e.target.classList.contains('nav-link')) {
                e.preventDefault();
                const category = e.target.dataset.category;
                document.querySelectorAll('.category-link').forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.category === category) {
                        link.classList.add('active');
                    }
                });
                loadArticles(category);
            }

            // æ–‡ç« é“¾æ¥
            if (e.target.classList.contains('article-link')) {
                e.preventDefault();
                loadArticle(parseInt(e.target.dataset.id));
            }
        });

        // ===== é˜…è¯»è¿›åº¦æ¡ =====
        let hideProgressTimer = null;
        const HIDE_DELAY = 5000; // 5ç§’

        function updateProgress() {
            const container = document.getElementById('articleContainer');
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight;
            const scrollTop = window.scrollY;

            // è®¡ç®—è¿›åº¦ç™¾åˆ†æ¯”
            const scrollableHeight = documentHeight - windowHeight;
            const progress = scrollableHeight > 0 
                ? Math.min(Math.round((scrollTop / scrollableHeight) * 100), 100)
                : 0;

            // æ›´æ–°è¿›åº¦æ¡
            const progressFill = document.getElementById('progressFill');
            const circumference = 2 * Math.PI * 45; // åŠå¾„ä¸º 45
            const offset = circumference - (progress / 100) * circumference;
            progressFill.style.strokeDasharray = circumference;
            progressFill.style.strokeDashoffset = offset;

            // æ›´æ–°ç™¾åˆ†æ¯”æ˜¾ç¤º
            document.getElementById('progressPercentage').textContent = progress + '%';

            // æ›´æ–°é˜…è¯»æ—¶é—´
            if (currentArticle) {
                const readTime = Math.max(1, Math.round((progress / 100) * currentArticle.readTime));
                document.getElementById('readingTime').textContent = readTime + ' åˆ†é’Ÿ';
            }
        }

        function showProgressCircle() {
            const progressCircle = document.getElementById('progressCircle');
            progressCircle.classList.remove('hidden');
            progressCircle.classList.add('visible');

            // æ¸…é™¤ä¹‹å‰çš„éšè—è®¡æ—¶å™¨
            if (hideProgressTimer) {
                clearTimeout(hideProgressTimer);
            }

            // è®¾ç½®æ–°çš„éšè—è®¡æ—¶å™¨
            hideProgressTimer = setTimeout(() => {
                progressCircle.classList.remove('visible');
                progressCircle.classList.add('hidden');
            }, HIDE_DELAY);
        }

        // ç›‘å¬æ»šåŠ¨äº‹ä»¶
        window.addEventListener('scroll', function() {
            updateProgress();
            showProgressCircle();
        });
        window.addEventListener('resize', updateProgress);

        // ç‚¹å‡»è¿›åº¦æ¡æ»šåŠ¨åˆ°é¡¶éƒ¨
        document.getElementById('progressCircle').addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // åˆå§‹åŒ–æ—¶æ˜¾ç¤ºè¿›åº¦æ¡
        showProgressCircle();

                // ===== åˆå§‹åŒ– =====
        loadArticles('all');
        updateProgress();
    </script>
</body>
</html>
